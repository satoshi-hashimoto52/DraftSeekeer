# Security & Privacy

本書は現行コードから仕様を抽出して記載しています。動作確認・実運用での検証は別途必要です。

## データの取り扱い方針（現行実装）
- 画像・アノテーション・テンプレートはローカルファイルに保存。
- 保存先は主に `data/` 配下。
- 外部クラウド送信処理は現行コード上に実装されていない。

## 外部通信の有無
- ブラウザ ↔ ローカル FastAPI (`127.0.0.1:8000`) の通信のみが前提。
- `segment-anything` 利用もローカルモデル推論。
- 外部APIへのHTTP送信処理は実装上確認できない。

## 画像・アノテーションの保存範囲
- 画像: `data/datasets/<project>/images/`
- アノテーション: `data/datasets/<project>/annotations/*.json`
- テンプレート: `data/templates/...`
- エクスポート結果: 指定 `output_dir` と `data/datasets/<project>/exports_index.json`

## ログ・一時データ
- APIエラー時の詳細は uvicorn コンソールに出力される可能性。
- メモリアップロード画像は `IN_MEMORY_IMAGES` に保持され、プロセス終了で消失。
- 一時zip/一時画像ファイルを使う処理あり（`tempfile`）。

## セキュリティ上の注意
- CORS が全許可 (`*`) のため、実運用公開には制限が必要。
- `/export/yolo/download?path=...` は `RUNS_DIR` 配下チェックのみ。パス検証ルールの追加監査が望ましい。
- export先ディレクトリは任意絶対パス指定可能。運用側の権限制御が必要。

## 推奨ハードニング
1. CORS 許可オリジンを限定
2. 認証なしAPIを社内ネットワーク限定
3. ログ出力に個人情報を含めないルール化
4. 出力ディレクトリの許可リスト化

## 未検証
- 複数ユーザー同時利用時の権限境界は未実装。
- データ暗号化・監査ログ要件は未定義。
